<%
  var gravatar = 'https://www.gravatar.com/avatar/'
      + this.model.get('author').gravatar + '?s=26&d=identicon';

  var num_channels = this.model.get('channels_cnt');
  if (num_channels === 1) {
    num_channels += ' channel';
  } else {
    num_channels += ' channels';
  }

  var source = '';
  if (this.model.get('source')) {
    source += this.model.get('source');
  }
  var link = this.model.get('sourceLink');
  if (link) {
    if (source !== '') {
      if (this.parentView) {
        source = '<a class="event-source" href="' + link + '" target="_blank"><i class="icon-link"></i>' + source + '</a>';
      } else {
        source = '<a href="' + link + '" target="_blank">' + source + '</a>';
      }
    } else {
      if (this.parentView) {
        source = '<a class="event-source" href="' + link + '" target="_blank"><i class="icon-link"></i>' + link + '</a>';
      } else {
        source = '<a href="' + link + '" target="_blank">' + link + '</a>';
      }
    }
  }

  var tags = this.model.get('tags') || [];
  var vcnt = this.model.get('vcnt') === undefined ? 0: this.model.get('vcnt');
%>

<% if (!this.parentView) { %>
  <% if (this.config) { %>
    <div class="leftside settings">
    <h2 class="settings-divider">Dataset Information</h2>
    <form enctype="multipart/form-data" method="POST">
      <table>
        <tbody>

          <% if ((Date.now() - new Date(this.model.get('created'))) < 1000*60*5) { %>
            <tr>
              <td colspan = "2">
                <div class="dataset-config-greeting">
                  <h2>
                    Great! You've successfully added a new dataset titled &ldquo;<%= this.model.get('title') %>&rdquo; to Skyline.</h2>
                  <br>
                  <p>
                    Add some information about your dataset or immediately interact with your data by clicking a channel below.
                  </p>
                </div>
              </td>
            </tr>
          <% } %>

          <tr>
            <td>
              <label for="datasetTitle">Title</label>
            </td>
            <td class="textright">
              <div class="settings-saved">
                <span class="icon-check"></span>
                <span>Saved</span>
              </div>
              <span class="settings-error page-error"></span>
            </td>
          </tr>
          <tr>
            <td>
              <input type="text" tabindex="1" id="datasetTitle" name="title"
                  placeholder="title" value="<%= this.model.get('title') %>" />
            </td>
            <td style="width:84px">
              <label class="checkbox-styled input-checkbox">
                <input class="settings-public" type="checkbox" name="public" value="public" />
                <span style="padding:0; width:84px;"><i class="icon-lock-open"></i> Public</span>
              </label>
            </td>

          </tr>

          <tr>
            <td>
              <label for="datasetTags">Tags</label>
            </td>
            <td class="textright">
              <div class="settings-saved">
                <span class="icon-check"></span>
                <span>Saved</span>
              </div>
              <span class="settings-error page-error"></span>
            </td>
          </tr>
          <tr>
            <td colspan = "2">
              <input type="text" tabindex="2" id="datasetTags" name="tags"
                  placeholder="tags" value="<%= this.model.get('tags') %>" />
            </td>
          </tr>

          <tr>
            <td>
              <label for="datasetDescription">Description</label>
            </td>
            <td class="textright">
              <div class="settings-saved">
                <span class="icon-check"></span>
                <span>Saved</span>
              </div>
              <span class="settings-error page-error"></span>
            </td>
          </tr>
          <tr>
            <td colspan = "2">
              <textarea name="description" class="" tabindex="3" id="datasetDescription"
                    placeholder="Write something about your data..."><%= this.model.get('description') %>
              </textarea>
            </td>
          </tr>

          <tr>
            <td>
              <label for="datasetSource">Source</label>
            </td>
            <td class="textright">
              <div class="settings-saved">
                <span class="icon-check"></span>
                <span>Saved</span>
              </div>
              <span class="settings-error page-error"></span>
            </td>
          </tr>
          <tr>
            <td colspan = "2">
              <input type="text" tabindex="4" id="datasetSource" name="source"
                  placeholder="source" value="<%= this.model.get('source') %>" />
            </td>
          </tr>

          <tr>
            <td>
              <label for="datasetSourceLink">Source Link</label>
            </td>
            <td class="textright">
              <div class="settings-saved">
                <span class="icon-check"></span>
                <span>Saved</span>
              </div>
              <span class="settings-error page-error"></span>
            </td>
          </tr>
          <tr>
            <td colspan = "2">
              <input type="text" tabindex="5" id="datasetSourceLink" name="sourceLink"
                  placeholder="link" value="<%= this.model.get('sourceLink') %>" />
            </td>
          </tr>

          <tr>
            <td colspan="2">
              <a tabindex="6" href="javascript:;" class="demolish button connect-button delete-button">
                Delete Dataset
                <i class="icon-right-open-big"></i>
              </a>
            </td>
          </tr>

        </tbody>
      </table>
    </form>

  <% } else { %>
    <div class="leftside">
  <% } %>
<% } %>

<% if (this.parentView) { %>
  <div class="event-title">
    <a href="/<%= this.model.get('author').username %>" class="title navigate">
      <%= this.model.formatAuthorFor(this.app.profile.user) %></a> added a 
      <a href="/<%= this.model.get('author').username %>/<%= this.model.id %>" class="title navigate">dataset</a> 
      with <%= num_channels %>.
    <% if (source !== '') { %>
      <%= source %>
    <% } %>
  </div>
  <span class="event-title-text">
    <a href="/<%= this.model.get('author').username %>/<%= this.model.id %>" class="title-large navigate">
      <%= this.model.formatTitle() %>
    </a>
  </span>
  <span class="event-timeline-label event-timeline-label-first">
    <i class="icon-database"></i>
  </span>
  <% if (this.model.get('description')) { %>
    <p class="event-description">
      <% if (this.model.get('description')) { %>
        <%= this.model.description() %>
      <% } %>
    </p>
  <% } %>
<% } %>

<% if (this.config) { %>
  <h2 class="settings-divider">Dataset Channels</h2>
<% } else { %>
  <% if (tags.length > 0) { %>
    <span class="event-tags">
      Tags: <% _.each(tags, function(t, i) { %>
        #<%= t %><% if (i < tags.length - 1) { %>,<% } %>
      <% }); %>
    </span>
  <% } %>
<% } %>

<% if (this.model.get('channels').length !== 0) { %>
  <ul class="event-channels">
    <% _.each(this.model.get('channels'), _.bind(function (c) { %>
      <li id="<%= c.channelName %>" data-id="<%= c.id %>">
        <a href="/<%= this.model.get('author').username %>/<%= this.model.id %>/<%= c.channelName %>"
            class="navigate">
          <span class="event-timeline-label">
            <i class="icon-chart-line"></i>
          </span>
          <span class="event-timeline-label-text"></span>
          <span class="event-channel-name">
            <%= c.humanName %>
          </span>
          <div class="event-channel-svg"></div>
          <p class="event-channel-note">
            
          </p>
          <% if (this.config && this.app.profile.user &&
              this.model.get('author').id === this.app.profile.user.id) { %>
            <a href="javascript:;" class="event-channel-delete">
              <i class="icon-cancel"></i>
            </a>
          <% } %>
        </a>
      </li>
    <% }, this)); %>
  </ul>
<% } %>
<% if (!this.config) { %>
  <div class="event-info">
    Added <a href="/<%= this.model.get('author').username %>/<%= this.model.id %>"
          class="navigate"><time class="created" 
          datetime="<%= this.model.get('created') %>" 
          title="<%= this.model.get('created') %>">
      <%= this.model.get('created') %>
    </time></a>
    <span class="info-divider">&nbsp;&middot;&nbsp;</span>
    <%= vcnt %> view<%= vcnt === 1 ? '': 's' %>
    <% if (this.app.profile.user &&
        this.model.get('author').id === this.app.profile.user.id) { %>
      <span class="info-divider">&nbsp;&middot;&nbsp;</span>
      <a href="/<%= this.model.get('author').username %>/<%= this.model.id %>/config"
         class="info-settings navigate"><i class="icon-cog"></i>Configure
       </a>
    <% } %>
  </div>
  <div class="event-comments"></div>
<% } %>

<% if (!this.parentView) { %>
  </div>
  <div class="rightside">
    <% if (!this.config) { %>
      <div class="target-info">
        <span class="target-info-heading">Metadata</span>
        <ul class="target-info-list">
          <li>This dataset has <%= this.model.get('channels_cnt') %> channel<%= this.model.get('channels_cnt') === 1 ? '': 's' %></li>
          <li>Viewed <%= vcnt %> time<%= this.model.get('channels_cnt') === 1 ? '': 's' %></li>
          <% if (source !== '') { %>
            <li>Source: <%= source %></li>
          <% } %>
        </ul>
      </div>
      <div class="target-info">
        <span class="target-info-heading">Notes</span>
        <div class="event-notes"></div>
      </div>
    <% } else { %>
      <div class="target-info">
        <span class="target-info-heading">Change History</span>
        <div class="event-history"></div>
      </div>
    <% } %>
  </div>
  <div class="clearfix"></div>
<% } %>
