<%
  var link = ['library', this.model.id].join('/');

  var num_channels = this.model.get('channels_cnt');
  if (num_channels === 1) {
    num_channels += ' channel';
  } else {
    num_channels += ' channels';
  }

  var source = '';
  if (this.model.get('source')) {
    source += this.model.get('source');
  }
  var link = this.model.get('sourceLink');
  if (link) {
    if (source !== '') {
      source = '<a href="' + link + '" target="_blank"><i class="icon-link"></i>' + source + '</a>';
    } else {
      source = '<a href="' + link + '" target="_blank"><i class="icon-link"></i>' + link + '</a>';
    }
  }

  var tags = this.model.get('tags') || [];
%>

<div class="library-dataset-header">
  <div class="library-dataset-info"> 
    <%= num_channels %><%= source !== '' ? ' from ' + source: '' %>
  </div>
  <span class="library-dataset-title">
    <i class="<%= this.model.get('producer_id') ? 'icon-signal': 'icon-globe' %>"></i><a href="/library/<%= this.model.id %>"
        class="navigate"><%= this.model.get('title') %></a>
  </span>
  <% if (this.model.get('description') || tags.length > 0) { %>
    <p class="event-description">
      <% if (this.model.get('description')) { %>
        <%= this.model.description() %>
      <% } %>
      <% if (tags.length > 0) { %>
        <span class="event-tags">
          Tags: 
          <% _.each(tags, function(t, i) { %>
            <%= t %><% if (i < tags.length - 1) { %>,<% } %>
          <% }); %>
        </span>
      <% } %>
    </p>
  <% } %>
</div>
<% if (this.model.get('channels').length !== 0) { %>
  <ul class="event-channels">
    <% _.each(this.model.get('channels'), _.bind(function (c) { %>
      <li id="<%= c.channelName %>" data-id="<%= c.id %>">
        <a href="/library/<%= this.model.id %>/<%= c.channelName %>"
            class="navigate">
          <span class="event-channel-name">
            <%= c.humanName %>
          </span>
          <div class="event-channel-svg"></div>
          <% if (this.app.profile.user &&
                this.app.profile.user.username === 'library') { %>
            <a href="javascript:;" class="event-channel-delete">
              <i class="icon-cancel"></i>
            </a>
          <% } %>
        </a>
      </li>
    <% }, this)); %>
  </ul>
<% } %>
<div class="event-info">
  Updated <a href="/library/<%= this.model.id %>"
        class="navigate"><time class="created" 
        datetime="<%= this.model.get('updated') %>" 
        title="<%= this.model.get('updated') %>">
    <%= this.model.get('created') %>
  </time></a>
  <% if (this.app.profile.user &&
        this.app.profile.user.username === 'library') { %>
    <span class="info-divider">&nbsp;&middot;&nbsp;</span>
    <a href="javascript:;" class="info-delete">Delete</a>
  <% } %>
</div>
