#!/bin/sh -ev

# Build all native code for this platform.

cd "`dirname $0`"

echo Building protobuf library...
cd protobuf_for_node
BUILT="`pwd`/deps-built"
cd deps/protobuf-2.4.1
./configure --prefix="$BUILT"
make -j2 install
make distclean
cd ../..

echo Building protobuf_for_node...
PROTOBUF="`pwd`/deps-built" node-waf configure clean build
ln -sf build/default/protobuf_for_node.node index.node
cd ..

echo Building getrusage...
cd getrusage
node-waf configure clean build
cd ..

echo Building gzbz2...
cd gzbz2
node-waf configure clean build
cd ..
